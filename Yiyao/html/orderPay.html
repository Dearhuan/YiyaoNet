<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>订单确认</title>
  <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="../css/base_px.css">
  <link rel="stylesheet" href="../css/reset.css">
  <link rel="stylesheet" href="../css/carts.css">
  <link rel="stylesheet" href="../css/orderPay.css">
  <link rel="stylesheet" href="../css/foot_simple.css">
  <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js"></script>
  <script src="../js/Cookie.js"></script>
  <!-- <script src="../js/carts.js"></script> -->
</head>

<body>
  <!--  ----------------------------头部---------------------------------------- -->
  <script>
    $('body').append('<div id="head"></head>');
    $('#head').load('./head.html');
  </script>
  <div class="c_head clearfix">
    <h1 id="logo"> <a title="1药网" target="_top" class="logo" href="./index.html">1药网<span class="i"></span></a>
    </h1>
    <div class="flow-steps">
      <ol class="num5">
        <li>
          <span>1. 我的购物车</span>
        </li>
        <li>
          <span>2. 填写核对订单信息</span>
        </li>
        <li class="last current">
          <span>3. 成功提交订单</span>
        </li>
      </ol>
    </div>
  </div>

  <!-- -----------------------------商品信息------------------------------------------------ -->
  <div class="c_content">
    <div class="success_box zaixin">
      <div class="s_inner clearfix">
        <div class="s_l"><i class="s_ok"></i></div>
        <div class="s_r">
          <h4>订单已提交成功，请您尽快付款！</h4>
          <p>请您在提交订单后<b class="red">24小时</b>内完成支付，否则订单会自动取消。 </p>
          <div class="s_o">
            <p class="mb10"><b>订单编号：</b>
              <a href="#" target="_blank" class="blue mr10 orderNum"></a>
              <span class="ml20"> 订单金额：<span class="red oPrice"></span></span>
              <a href="javascript:;" class="blue choseother">选择其他在线支付<i class="b_icon"></i> </a>
            </p>
            <div class="p_online" id="orderBankInfo" style="display: block;">
              <div id="zx_pay_other" style="display: block;">
                <div class="zx_pay">
                  <ul class="clearfix">
                    <li id="userOrderSelectBank" class="b_600">
                      <input type="radio" class="ra_bank" checked="checked">
                    </li>
                    <li class="pay_price">支付金额：<span class="red oPrice"></span>
                    </li>
                  </ul>
                  <!--Add by Dancy-->
                  <div class="scanCode clearfix" id="alipayDiv" style="display: block;">
                    <i class="ico_or">&nbsp;</i>
                    <div class="sc_box fl">
                      <h5 class="sc_tit">使用电脑支付</h5>
                      <div class="sc_pic">&nbsp;</div>
                      <a href="javascript:;" class="pay_last_c"></a>
                    </div>
                    <div class="sc_box sc_boxRight fl">
                      <h5 class="sc_tit">使用支付宝钱包扫一扫即可付款</h5>
                      <!--h5 class="sc_tit">扫码支付立减5-10元（名额有限）</h5-->
                      <div class="sc_pic alipayImg">
                        <img id="alipayCode" src="../images/alipay.jpg" alt="" width="260" height="260">
                        <!-- <img src="../images/aliCode.png" id="aliCode" alt=""> -->
                      </div>
                    </div>
                  </div>
                  <!--End add-->
                  <!--Add by weixin-->
                  <div class="scanCode clearfix" id="alipayDiv_weixin" style="display: none;">
                    <div class="erweima fl">
                      <img id="weixin_MatrixImgUrl" src="../images/wechatpay.png" width="280" height="280">
                      <div class="btn_tip">请使用微信扫一扫<br>扫描二维码支付</div>
                    </div>
                    <div class="saoma fl">
                      <img src="//s.maiyaole.com/images/201306/images/2014/saoma.png">
                    </div>
                  </div>
                  <!--End add-->
                </div>
                <div class="operate clearfix">
                  <a href="javascript:;" class="pay_last" id="common_submit" style="display: none;"></a>
                </div>
                <div class="clearfix"></div>
              </div>
              <div id="zx_pay_douli" style="display: none;">
                <div class="zx_pay">
                  <div class="pay_h">
                    <div class="fl">
                      <label class="lbs mr10" for="">
                        <input type="radio" checked="">
                      </label>
                      <img class="logo_douli" src="//s.maiyaole.com/images/baogang/logo_douli.png" alt="">
                      <span>兜礼积分</span>
                    </div>
                    <span class="fr font12">需扣除兜礼积分：<span class="red">
                        34.50</span>分</span>
                  </div>
                  <div class="pay_b">
                    <p id="tip_getVerCode">已向您的兜礼账户预留手机号发送验证码，请注意查看</p>
                    <div class="check_num_box">
                      <input type="text" class="num" value="" maxlength="1">
                      <input type="text" class="num" value="" maxlength="1">
                      <input type="text" class="num" value="" maxlength="1">
                      <input type="text" class="num" value="" maxlength="1">
                      <input type="text" class="num" value="" maxlength="1">
                      <input type="text" class="num" value="" maxlength="1">
                      <input type="button" id="sendBtn" class="send_btn" value="重新发送">
                      <p id="douli_pay_error" class="tip">支付失败，手机验证码错误</p>
                    </div>
                    <div class="btn_wrap">
                      <button id="submit" class="btn disable" disabled="disabled">确认支付</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="s_other" id="showOtherBank" style="display: none;">
              <div class="p_t">支付平台</div>
              <ul class="pay_select clearfix">
                <li data-ywpoint="null_null_null_null_I5000_0" class="zhifu bank">
                  <input type="radio" class="ra_bank" value="600" name="ra_bank">
                </li>
                <li data-ywpoint="null_null_null_null_I5000_3" class="weixin bank">
                  <input type="radio" name="ra_bank" value="608" class="ra_bank" checked="checked">
                </li>
                <input value="0 0" type="hidden">
              </ul>
              <a href="javascript:;" class="paysure_btn">确认支付方式</a>
              <div class="clearfix"></div>
            </div>
          </div>

        </div>
      </div>
    </div>
    <div class="mask_div" id="maskDiv" style="display: none;"></div>
    <div class="pop_pay" id="orderPaySure" style="display: none;">
      <div class="pop_inner">
        <h4>请在新的支付页面完成付款！</h4>
        <p>付款成功：<a href="//my.111.com.cn/ucenter/orderDetail.action?orderId=20190928214058554917" target="_blank"
            class="blue">查看订单详情</a></p>
        <p>付款失败：<a href="javascript:;" onclick="javascript:showOtherBank(0);" class="blue">选择其他在线支付</a></p>
      </div>
      <a href="javascript:;" onclick="javascript:showMaskDiv(1);" class="pop_close"></a>
    </div>
    <div class="wrap">
      <div class="q_a">
        付款遇到问题？
        <b>1.网上银行已经扣款，但订单状态仍显示未付款？</b>
        答：由于银行的数据没有及时传输给系统，我们会尽快与银行对账后给与确认，请您耐心等待。
        <b>2.网上银行页面打不开，怎么办？</b>
        答：建议使用IE浏览器。点击IE菜单“工具”－“Internet选项”－“安全”，将安全中的各项设置恢复到默认级别。
        <b>3.网上银行重复多次付款了怎么办？</b>
        答：请联系客服，我们会在你提交申请后，尽快和银行核对。确认您的汇款后，重复支付付款会原路返回至你的支付账户。
        <b class="red">其他付款问题请咨询客服：400-007-0958</b>

      </div>
    </div>
  </div>

  <!-- ------------------------------底部------------------------------------------------- -->
  <script>
    $('body').append('<div class="common_footer_simple">');
    $('.common_footer_simple').load('./footer_simple.html');
  </script>

  <script>
    let cookieUsername = Cookie.get('username'); //检查cookie
    let cookiePassword = Cookie.get('password');

    $.ajax({ //获取订单金额，生成订单编号，生成支付二维码
      type: "get",
      url: "../api/getCartData.php",
      dataType: "json",
      success: function (res) {
        if (res.status == 'success') {
          let data = res.data.goods;
          let total_money = 0;
          data.forEach(ele => {
            let goodNum = ele.num * 1;
            let goodPrice = ele.price * 1;
            total_money += goodNum * goodPrice;
          })
          let orderNum = location.search.split('=')[1];
          $('.orderNum').text(orderNum);
          $('.oPrice').html(`<em class="f_a">¥</em>${total_money.toFixed(2)}`);

          $('.pay_last_c').click(function (e) { //接入支付宝沙箱
            e.preventDefault();
            location.href = `../alipay/index.php?orderId=${orderNum}&price=${total_money.toFixed(2)}&order=myOrder`;
          })
        } else if (res.status == 'none') {
          let data = res.data;
        }
      }
    });


    window.onload = function () {
      $('.choseother').click(function (e) { //切换支付方式
        e.preventDefault();
        console.log('toggle');
        $('#zx_pay_other').hide();
        $('#showOtherBank').show();
      });



      $('.paysure_btn').click(function (e) {
        e.preventDefault();
        if ($('.weixin input').is(':checked')) { //微信支付
          $('#userOrderSelectBank').addClass('b_608').removeClass('.b_600');
          $('#zx_pay_other').show();
          $('#alipayDiv').hide();
          $('#showOtherBank').hide();
          $('#alipayDiv_weixin').show();
        } else if ($('.zhifu input').is(':checked')) { //支付宝
          $('#userOrderSelectBank').addClass('b_600').removeClass('b_608');
          $('#zx_pay_other').show();
          $('#alipayDiv_weixin').hide();
          $('#showOtherBank').hide();
          $('#alipayDiv').show();
        }
      })


      $('.iyaonet').on('mouseenter', function () { //我的医药网（鼠标移入移出common）
        $(this).siblings('ul').stop().show();
        // $(this).siblings('ul').on('mouseenter', 'li', function () {});
        $(this).siblings('ul').on('mouseleave', function () {
          $(this).hide();
        })
      });

      $('.favorite').click(function (e) { //收藏本站(common)
        e.preventDefault();
        confirm('抱歉，您所使用的的浏览器无法完成此操作 \n 加入收藏失败，请使用Ctrl+D进行添加');
      });

      $('.province_box').hover(function () { //(省份)(common)
        $(this).children('ul').stop().show();
      }, function () {
        $(this).children('ul').hide();
      });

      $('#headerAllProvince').on('click', 'a', function (e) { //点击省份替换(common)
        e.preventDefault();
        $('.province').children().text($(this).text());
      })

      $('.tell').hover(function () { //手机二维码(common)
        $(this).siblings('.tell_title').stop().show();
        $(this).siblings('#menu_bd_app').stop().show();
      }, function () {
        $(this).siblings('.tell_title').hide();
        $(this).siblings('#menu_bd_app').hide();
      });
      let cUsername, cPassword;

      function checkCookie() {
        cUsername = Cookie.get('username'); //检查cookie
        cPassword = Cookie.get('password');
        if (cUsername && cPassword) return true;
      };

      checkCookie() ? $('#ilogin').text(cUsername) : $('#ilogin').text('请登录');

      $('#orderSubmitButton').click(function () {
        location.href = './orderPay.html';
      })
    }
  </script>
</body>

</html>